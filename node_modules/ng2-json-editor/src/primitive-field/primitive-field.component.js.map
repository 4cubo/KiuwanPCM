{"version":3,"sources":["../../../staging/src/primitive-field/primitive-field.component.ts"],"names":[],"mappings":"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","file":"primitive-field.component.js","sourceRoot":"","sourcesContent":["/*\n * This file is part of ng2-json-editor.\n * Copyright (C) 2016 CERN.\n *\n * ng2-json-editor is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License as\n * published by the Free Software Foundation; either version 2 of the\n * License, or (at your option) any later version.\n *\n * ng2-json-editor is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with ng2-json-editor; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place, Suite 330, Boston, MA 02111-1307, USA.\n * In applying this license, CERN does not\n * waive the privileges and immunities granted to it by virtue of its status\n * as an Intergovernmental Organization or submit itself to any jurisdiction.\n*/\n\nimport {\n  Component,\n  Input,\n  ViewEncapsulation,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\n\nimport { AbstractFieldComponent } from '../abstract-field';\nimport {\n  AppGlobalsService,\n  ProblemsService,\n  ComponentTypeService,\n  JsonStoreService,\n  KeysStoreService,\n  SchemaValidationService,\n  PathUtilService,\n  DomUtilService\n} from '../shared/services';\nimport { JSONSchema, JsonPatch } from '../shared/interfaces';\nimport { Subscription } from 'rxjs/Subscription';\nimport { ValidationProblem } from '../shared/interfaces';\n\n\nexport class PrimitiveFieldComponent extends AbstractFieldComponent implements OnInit, OnDestroy {\n\n   schema: JSONSchema;\n   path: Array<any>;\n   value: string | number | boolean;\n\n  internalErrors: Array<ValidationProblem> = [];\n  private lastCommitedValue: string | number | boolean;\n\n  constructor(public schemaValidationService: SchemaValidationService,\n    public componentTypeService: ComponentTypeService,\n    public appGlobalsService: AppGlobalsService,\n    public problemsService: ProblemsService,\n    public jsonStoreService: JsonStoreService,\n    public keysStoreService: KeysStoreService,\n    public pathUtilService: PathUtilService,\n    public domUtilService: DomUtilService,\n    public changeDetectorRef: ChangeDetectorRef) {\n    super(appGlobalsService, problemsService, pathUtilService, changeDetectorRef, jsonStoreService);\n  }\n\n  ngOnInit() {\n    super.ngOnInit();\n\n    if (this.value !== this.schema.default) {\n      this.lastCommitedValue = this.value;\n    }\n    this.problemsService\n      .internalCategorizedProblems$\n      .takeUntil(this.isDestroyed)\n      .subscribe(internalCategorizedErrorMap => {\n        this.internalErrors = internalCategorizedErrorMap.errors[this.pathString] || [];\n      });\n    this.appGlobalsService\n      .adminMode$\n      .takeUntil(this.isDestroyed)\n      .subscribe(adminMode => {\n        this.changeDetectorRef.markForCheck();\n      });\n    this.validate();\n  }\n\n  ngOnDestroy() {\n    super.ngOnDestroy();\n    if (this.internalErrors.length > 0) {\n      this.problemsService.setInternalProblemsForPath(this.pathString, []);\n    }\n  }\n\n  commitValueChange() {\n    this.validate();\n    this.lastCommitedValue = this.value;\n    this.jsonStoreService.setIn(this.path, this.value);\n\n    if (this.schema.onValueChange) {\n      // setTimeout to workaround the case when the value is changed back to previous value inside onValuChange callback\n      setTimeout(() =>\n        this.schema.onValueChange(this.path, this.value, this.jsonStoreService, this.keysStoreService)\n      );\n    }\n  }\n\n  onBlur() {\n    this.domUtilService.clearHighlight();\n\n    if (this.value !== this.lastCommitedValue) {\n      this.commitValueChange();\n    }\n  }\n\n  onKeypress(event: KeyboardEvent) {\n    if (event.key === 'Enter' && !event.shiftKey) {\n      event.preventDefault();\n      (document.activeElement as HTMLElement).blur();\n    }\n  }\n\n  onValueChange(value: string) {\n    this.value = value;\n  }\n\n  onSearchableDropdownSelect(value: string) {\n    this.value = value;\n    this.commitValueChange();\n  }\n\n  get tabIndex(): number {\n    return this.disabled ? -1 : 1;\n  }\n\n  get tooltipPosition(): string {\n    if (this.pathString.startsWith(this.appGlobalsService.firstElementPathForCurrentTab)) {\n      return 'bottom';\n    } else {\n      return 'top';\n    }\n  }\n\n  hasErrors(): boolean {\n    return super.hasErrors() || this.internalErrors.length > 0;\n  }\n\n  get errorClass(): string {\n    return !this.replaceJsonPatches[0] && this.hasErrors() ? 'error' : '';\n  }\n\n  get isPathToAnIndex(): boolean {\n    return typeof this.path[this.path.length - 1] === 'number';\n  }\n\n  private validate() {\n    if (this.value != null && this.value !== '' && this.externalErrors.length === 0) {\n      this.internalErrors = this.schemaValidationService.validateValue(this.value, this.schema);\n      this.problemsService.setInternalProblemsForPath(this.pathString, this.internalErrors);\n    }\n  }\n\nstatic decorators: DecoratorInvocation[] = [\n{ type: Component, args: [{\n  selector: 'primitive-field',\n  encapsulation: ViewEncapsulation.None,\n  styles: [\"td.value-container div[contenteditable=true], td.value-container input { vertical-align: middle; transition: all 0.5s ease; border: none; background-color: transparent; display: inline-block; width: 100%; } table.primitive-field-container { width: 100%; } td.link-button-container { width: 22px; } td.value-container { width: 100%; padding: 3px 3px 3px 6px !important; } td.value-container:hover { background-color: #ffa !important; } a.no-decoration { text-decoration: none; } [contenteditable=true] { min-height: 18px; word-break: break-word; } [contenteditable=true]:empty:before { content: attr(placeholder); color: darkgray; display: block; /* For Firefox */ } .tooltip-left-align { margin-left: 12px; padding: 0px; } .btn-merge { border: none; background: transparent; width: 100%; text-align: left; white-space: normal; } .orange-left-border { border-left: 9px solid #e67e22; border-radius: 0; } .fa-bolt { color: #e67e22; } \"],\n  template: \"<div [id]=\\\"pathString\\\" [ngClass]=\\\"redLeftBorderClass\\\"> <table class=\\\"primitive-field-container\\\" [ngSwitch]=\\\"schema.componentType\\\"> <tr [ngClass]=\\\"errorClass\\\"> <ng-template #errorsTooltipTemplate> <ul class=\\\"tooltip-left-align\\\"> <li *ngFor=\\\"let error of internalErrors\\\"> {{error.message}} </li> <li *ngFor=\\\"let error of externalErrors\\\"> {{error.message}} </li> </ul> </ng-template> <td *ngIf=\\\"!replaceJsonPatches[0]; else patchTemplate\\\" class=\\\"value-container\\\" [class.disabled]=\\\"disabled\\\" [tooltip]=\\\"errorsTooltipTemplate\\\" [isDisabled]=\\\"!hasErrors()\\\" placement=\\\"{{tooltipPosition}}\\\" container=\\\"body\\\"> <div *ngSwitchCase=\\\"'string'\\\"> <string-input [pathString]=\\\"pathString\\\" [value]=\\\"value\\\" (valueChange)=\\\"onValueChange($event)\\\" [disabled]=\\\"disabled\\\" [tabIndex]=\\\"tabIndex\\\" [latexPreviewEnabled]=\\\"schema.latexPreviewEnabled\\\" [placeholder]=\\\"schema.title\\\" (blur)=\\\"onBlur()\\\" (onKeypress)=\\\"onKeypress($event)\\\"> </string-input> </div> <div *ngSwitchCase=\\\"'enum'\\\"> <searchable-dropdown [pathString]=\\\"pathString\\\" [value]=\\\"value\\\" [placeholder]=\\\"schema.title\\\" [items]=\\\"schema.enum\\\" [shortcutMap]=\\\"schema.enumShorcutMap\\\" (onSelect)=\\\"onSearchableDropdownSelect($event)\\\" [displayValueMap]=\\\"schema.enumDisplayValueMap\\\" [tabIndex]=\\\"tabIndex\\\" (onBlur)=\\\"onBlur()\\\"></searchable-dropdown> </div> <div *ngSwitchCase=\\\"'autocomplete'\\\"> <autocomplete-input [pathString]=\\\"pathString\\\" [value]=\\\"value\\\" [path]=\\\"path\\\" [autocompletionConfig]=\\\"schema.autocompletionConfig\\\" (onBlur)=\\\"onBlur()\\\" (onKeypress)=\\\"onKeypress($event)\\\" (onValueChange)=\\\"onValueChange($event)\\\" [placeholder]=\\\"schema.title\\\" [tabIndex]=\\\"tabIndex\\\"></autocomplete-input> </div> <div *ngSwitchCase=\\\"'integer'\\\"> <input type=\\\"number\\\" [(ngModel)]=\\\"value\\\" [tabindex]=\\\"tabIndex\\\" [attr.data-path]=\\\"pathString\\\" (blur)=\\\"onBlur()\\\" (keypress)=\\\"onKeypress($event)\\\" [placeholder]=\\\"schema.title\\\"> </div> <div *ngSwitchCase=\\\"'boolean'\\\"> <input type=\\\"checkbox\\\" [(ngModel)]=\\\"value\\\" (ngModelChange)=\\\"onBlur()\\\" [placeholder]=\\\"schema.title\\\"> </div> <div *ngSwitchDefault> ## Not recognized type: {{valueType}} </div> </td> <td class=\\\"link-button-container\\\"> <a *ngIf=\\\"schema.linkBuilder\\\" class=\\\"no-decoration\\\" target=\\\"_blank\\\" [href]=\\\"schema.linkBuilder(value)\\\"> <i class=\\\"fa fa-link\\\" aria-hidden=\\\"true\\\"></i> </a> <a *ngIf=\\\"!schema.linkBuilder && schema.format === 'url'\\\" class=\\\"no-decoration\\\" target=\\\"_blank\\\" [href]=\\\"value\\\"> <i class=\\\"fa fa-link\\\" aria-hidden=\\\"true\\\"></i> </a> </td> </tr> <tr *ngIf=\\\"removeJsonPatch\\\"> <patch-actions [patch]=\\\"removeJsonPatch\\\"></patch-actions> </tr> </table> </div> <ng-template #patchTemplate> <button class=\\\"btn btn-default btn-merge orange-left-border\\\" type=\\\"button\\\" [popover]=\\\"mergePopover\\\" [popoverContext]=\\\"{currentValue: value, patchValue: replaceJsonPatches[0].value}\\\" popoverTitle=\\\"Merge\\\" container=\\\"body\\\"> {{value}} <i class=\\\"fa fa-bolt\\\"></i> </button> </ng-template> <ng-template let-currentValue=\\\"currentValue\\\" let-patchValue=\\\"patchValue\\\" #mergePopover> <text-diff [currentText]=\\\"currentValue.toString()\\\" [newText]=\\\"patchValue ? patchValue.toString() : ''\\\"></text-diff> <patch-actions [patch]=\\\"replaceJsonPatches[0]\\\" [addActionEnabled]=\\\"isPathToAnIndex\\\"></patch-actions> </ng-template>\",\n  changeDetection: ChangeDetectionStrategy.OnPush\n}, ] },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: SchemaValidationService, },\n{type: ComponentTypeService, },\n{type: AppGlobalsService, },\n{type: ProblemsService, },\n{type: JsonStoreService, },\n{type: KeysStoreService, },\n{type: PathUtilService, },\n{type: DomUtilService, },\n{type: ChangeDetectorRef, },\n];\nstatic propDecorators: {[key: string]: DecoratorInvocation[]} = {\n'schema': [{ type: Input },],\n'path': [{ type: Input },],\n'value': [{ type: Input },],\n};\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}