{"version":3,"sources":["../../../../staging/src/shared/services/dom-util.service.ts"],"names":[],"mappings":"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","file":"dom-util.service.js","sourceRoot":"","sourcesContent":["/*\n * This file is part of ng2-json-editor.\n * Copyright (C) 2016 CERN.\n *\n * ng2-json-editor is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License as\n * published by the Free Software Foundation; either version 2 of the\n * License, or (at your option) any later version.\n *\n * ng2-json-editor is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with ng2-json-editor; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place, Suite 330, Boston, MA 02111-1307, USA.\n * In applying this license, CERN does not\n * waive the privileges and immunities granted to it by virtue of its status\n * as an Intergovernmental Organization or submit itself to any jurisdiction.\n*/\n\nimport { Injectable } from '@angular/core';\n\nimport { TabsUtilService } from './tabs-util.service';\nimport { ListPageChangerService } from './list-page-changer.service';\n\nimport { JsonPatch } from '../interfaces';\n\n\nexport class DomUtilService {\n\n  private readonly editableSelector = '.value-container input, div[contenteditable=true], .switch-input, searchable-dropdown span.value';\n  // highlight class is defined in json-editor.component.scss\n  private readonly highlightClass = 'highlight';\n  private highlightedElement: HTMLElement;\n\n  constructor(private tabsUtilService: TabsUtilService,\n    private listPageChangerService: ListPageChangerService) { }\n\n  focusAndSelectFirstEditableChildById(id: string, highlight = false) {\n    this.tabsUtilService.selectTabIfNeeded(id);\n    this.listPageChangerService.changePage(id);\n    setTimeout(() => {\n      const el = document.getElementById(id);\n      if (el) {\n        const firstEditable = el.querySelector(this.editableSelector) as HTMLElement;\n        if (firstEditable) {\n          if (firstEditable.classList.contains('hidden')) {\n            // has latex preview, click to disable to preview\n            (firstEditable.nextElementSibling as HTMLElement).click();\n            setTimeout(() => {\n              this.focusAndSelectContent(firstEditable, highlight);\n            });\n          } else {\n            this.focusAndSelectContent(firstEditable, highlight);\n          }\n        } else {\n          // if element doesn't have any input, open add-field-dropdown if it exists.\n          this.openDropdown(el);\n        }\n      }\n    });\n  }\n\n  private focusAndSelectContent(el: HTMLElement, highlight: boolean) {\n    el.focus();\n    this.selectAllContent(el);\n    if (highlight) {\n      el.classList.add(this.highlightClass);\n      this.highlightedElement = el;\n    }\n  }\n\n  focusFirstInputChildByElement(el: HTMLElement) {\n    const firstInput = el.querySelector('input') as HTMLElement;\n    if (firstInput) {\n      firstInput.focus();\n    }\n  }\n\n  focusRightOrLeftParentCell(id: string, direction: number) {\n    const el = document.getElementById(id);\n    if (el && el.tabIndex) {\n      let elementParentCell = el.parentElement;\n      while (elementParentCell.nodeName !== 'TD') {\n        elementParentCell = elementParentCell.parentElement;\n      }\n      let nextSibling = direction > 0 ? elementParentCell.nextElementSibling : elementParentCell.previousElementSibling;\n      while (nextSibling && nextSibling.nodeName === 'TD') {\n        const inputElement = nextSibling.querySelector(`input[tabindex='1'], div[contenteditable=true][tabindex='1']`) as HTMLElement;\n        if (inputElement) {\n          inputElement.focus();\n          this.selectAllContent(inputElement);\n          break;\n        }\n        nextSibling = direction > 0 ? nextSibling.nextElementSibling : nextSibling.previousElementSibling;\n      }\n    }\n  }\n\n  blurFirstEditableChildById(id: string) {\n    const el = document.getElementById(id);\n    const firstEditable = el.querySelector(this.editableSelector) as HTMLElement;\n    if (firstEditable) {\n      firstEditable.blur();\n    }\n  }\n\n  clearHighlight() {\n    if (this.highlightedElement) {\n      this.highlightedElement.classList.remove(this.highlightClass);\n      this.highlightedElement = undefined;\n    }\n  }\n\n  focusPatch(patch: JsonPatch) {\n    this.tabsUtilService.selectTabIfNeeded(patch.path);\n    this.listPageChangerService.changePage(patch.path);\n    setTimeout(() => {\n      const el = document.getElementById(patch.path);\n      const mergeButton = el.querySelector('.btn-merge') as HTMLButtonElement;\n      if (mergeButton) {\n        mergeButton.focus();\n        mergeButton.click();\n      } else {\n        const patchActionsContainer = el.querySelector(`.${patch.op}.patch-actions-container`) as HTMLElement;\n        if (patchActionsContainer) {\n          patchActionsContainer.focus();\n        }\n      }\n    });\n  }\n\n  private selectAllContent(el: HTMLElement) {\n    if (el instanceof HTMLInputElement) {\n      el.select();\n    } else {\n      // select all content for contenteditable element.\n      const range = document.createRange();\n      range.selectNodeContents(el);\n      const sel = window.getSelection();\n      sel.removeAllRanges();\n      sel.addRange(range);\n    }\n  }\n\n  private openDropdown(el: HTMLElement) {\n    const dropdown = el.querySelector('div.btn-group');\n    if (dropdown) {\n      const dropDownButton = dropdown.querySelector('button') as HTMLButtonElement;\n      if (dropDownButton) {\n        dropDownButton.click();\n      }\n    }\n  }\n\nstatic decorators: DecoratorInvocation[] = [\n{ type: Injectable },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: TabsUtilService, },\n{type: ListPageChangerService, },\n];\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}